#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

VALID=0

while read -r EMOJI TYPE; do
  if echo "$COMMIT_MSG" | grep -qE "^${EMOJI} ${TYPE}: .+"; then
    VALID=1
    break
  fi
done <<EOF
:sparkles: feat
:bug: fix
:memo: docs
:art: style
:recycle: refactor
:test_tube: test
:wrench: chore
EOF

if [ "$VALID" -eq 0 ]; then
  echo ""
  echo "ðŸš« Invalid commit message format!"
  echo ""
  echo "ðŸ’¡ Allowed formats:"
  echo "  :sparkles: feat: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€"
  echo "  :bug: fix: ë²„ê·¸ ìˆ˜ì •"
  echo "  :memo: docs: ë¬¸ì„œ ìˆ˜ì •"
  echo "  :art: style: ì½”ë“œ í¬ë§·íŒ…"
  echo "  :recycle: refactor: ì½”ë“œ ë¦¬íŒ©í† ë§"
  echo "  :test_tube: test: í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€"
  echo "  :wrench: chore: ë¹Œë“œ/ì„¤ì • ê´€ë ¨ ë³€ê²½"
  echo ""
  echo "ðŸ’â€â™€ï¸ ì˜ˆì‹œ: :sparkles: feat: ìœ íŠœë¸Œ ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€"
  exit 1
fi

echo "âœ… Valid commit message. Thanks!"
