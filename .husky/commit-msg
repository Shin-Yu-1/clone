#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

VALID=0

while read -r EMOJI TYPE; do
  if echo "$COMMIT_MSG" | grep -qE "^${EMOJI} ${TYPE}: .+"; then
    VALID=1
    break
  fi
done <<EOF
:sparkles: feat
:bug: fix
:memo: docs
:art: style
:recycle: refactor
:test_tube: test
:wrench: chore
EOF

if [ "$VALID" -eq 0 ]; then
  echo ""
  echo "🚫 Invalid commit message format!"
  echo ""
  echo "💡 Allowed formats:"
  echo "  :sparkles: feat: 새로운 기능 추가"
  echo "  :bug: fix: 버그 수정"
  echo "  :memo: docs: 문서 수정"
  echo "  :art: style: 코드 포맷팅"
  echo "  :recycle: refactor: 코드 리팩토링"
  echo "  :test_tube: test: 테스트 코드 추가"
  echo "  :wrench: chore: 빌드/설정 관련 변경"
  echo ""
  echo "💁‍♀️ 예시: :sparkles: feat: 유튜브 검색 기능 추가"
  exit 1
fi

echo "✅ Valid commit message. Thanks!"
